<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Planner Pro</title>

    <!-- PWA Manifest & Theme Color -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007991"> <!-- Colore barra indirizzi su mobile -->
    <!-- Eventuali icone per iOS -->
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="app-container">
        <header>
            <h1><i class="fas fa-plane-departure"></i> Travel Planner Pro</h1>
        </header>

        <div class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <h2><i class="fas fa-suitcase"></i> I Miei Viaggi</h2>
                <div class="trip-list-controls">
                    <button id="new-trip-btn" class="btn btn-primary"><i class="fas fa-plus"></i> Nuovo Viaggio</button>
                </div>
                <ul id="trip-list" class="trip-list"></ul>
                 <p id="no-trips-message" class="center-text muted" style="display: none;">Nessun viaggio.</p>
            </aside>

            <!-- Area Dettagli -->
            <main id="trip-details-area" class="trip-details-area" style="display: none;">
                <!-- Header Dettagli -->
                <div class="trip-header card">
                    <h2 id="trip-title">Dettagli Viaggio</h2>
                    <div class="trip-actions">
                        <button id="download-excel-btn" class="btn btn-success btn-sm" title="Scarica Excel"><i class="fas fa-file-excel"></i> Excel</button>
                        <button id="download-text-btn" class="btn btn-secondary btn-sm" title="Scarica Testo"><i class="fas fa-download"></i> Testo</button>
                        <button id="delete-trip-btn" class="btn btn-danger btn-sm" title="Elimina Viaggio"><i class="fas fa-trash-alt"></i> Elimina</button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab-link active" data-tab="info-tab"><i class="fas fa-info-circle"></i> Info</button>
                    <button class="tab-link" data-tab="participants-tab"><i class="fas fa-users"></i> Partecipanti</button>
                    <button class="tab-link" data-tab="transport-tab"><i class="fas fa-plane"></i> Trasporti</button>
                    <button class="tab-link" data-tab="accommodation-tab"><i class="fas fa-bed"></i> Alloggio</button>
                    <button class="tab-link" data-tab="itinerary-tab"><i class="fas fa-route"></i> Itinerario</button>
                    <button class="tab-link" data-tab="budget-tab"><i class="fas fa-coins"></i> Budget</button>
                    <button class="tab-link" data-tab="packing-tab"><i class="fas fa-suitcase-rolling"></i> Packing List</button>
                </div>

                <!-- == CONTENUTO TABS == -->
                <!-- Tab: Info -->
                <div id="info-tab" class="tab-content card active">
                    <h3><i class="fas fa-info-circle"></i> Informazioni Generali</h3>
                    <form id="trip-info-form">
                        <input type="hidden" id="edit-trip-id">
                        <div class="form-row">
                            <div class="form-control"> <label for="trip-name">Nome Viaggio:</label> <input type="text" id="trip-name" required> </div>
                            <div class="form-control"> <label for="trip-destination">Destinazione Principale:</label> <input type="text" id="trip-destination" placeholder="Es. Grecia, New York"> </div>
                        </div>
                        <div class="form-row">
                            <div class="form-control"> <label for="trip-start-date">Data Partenza Viaggio:</label> <input type="date" id="trip-start-date"> </div>
                            <div class="form-control"> <label for="trip-end-date">Data Ritorno Viaggio:</label> <input type="date" id="trip-end-date"> </div>
                        </div>
                        <div class="form-control"> <label for="trip-notes">Note Generali:</label> <textarea id="trip-notes" rows="4"></textarea> </div>
                        <div class="form-actions"> <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Salva Info</button> </div>
                    </form>
                </div>
                <!-- Tab: Partecipanti -->
                <div id="participants-tab" class="tab-content card">
                    <h3><i class="fas fa-users"></i> Partecipanti</h3>
                     <form id="add-participant-form" class="add-item-form">
                         <input type="hidden" id="edit-participant-id">
                         <div class="form-row">
                            <div class="form-control"> <label for="participant-name">Nome Partecipante:</label> <input type="text" id="participant-name" required placeholder="Nome Cognome"> </div>
                            <div class="form-control"> <label for="participant-notes">Note (opzionale):</label> <input type="text" id="participant-notes" placeholder="Es. Email, Telefono..."> </div>
                        </div>
                         <div class="form-actions"> <button type="submit" id="participant-submit-btn" class="btn btn-secondary"><i class="fas fa-plus"></i> Aggiungi</button> <button type="button" id="participant-cancel-edit-btn" class="btn btn-cancel" style="display: none;"><i class="fas fa-times"></i> Annulla</button> </div>
                     </form>
                     <div class="item-list-container"> <h4>Lista Partecipanti:</h4> <ul id="participant-list" class="item-list"></ul> <p id="no-participants-items" class="center-text muted" style="display: none;">Nessun partecipante.</p> </div>
                </div>
                <!-- Tab: Trasporti -->
                <div id="transport-tab" class="tab-content card"> /* ... come prima ... */ </div>
                <!-- Tab: Alloggio -->
                <div id="accommodation-tab" class="tab-content card">
                     <h3><i class="fas fa-bed"></i> Alloggi</h3>
                     <form id="add-accommodation-item-form" class="add-item-form">
                         <input type="hidden" id="edit-accommodation-item-id">
                         <div class="form-row"> <div class="form-control"> <label for="accommodation-name">Nome Hotel/Appartamento:</label> <input type="text" id="accommodation-name" required> </div> <div class="form-control"> <label for="accommodation-type">Tipo:</label> <select id="accommodation-type"> <option value="Hotel">Hotel</option> <option value="Appartamento">Appartamento</option> <option value="B&B">B&B</option> <option value="Ostello">Ostello</option> <option value="Casa Vacanze">Casa Vacanze</option> <option value="Altro">Altro</option> </select> </div> </div>
                         <div class="form-control"> <label for="accommodation-address">Indirizzo:</label> <input type="text" id="accommodation-address"> </div>
                         <div class="form-row"> <div class="form-control"> <label for="accommodation-checkin">Check-in (Data/Ora):</label> <input type="datetime-local" id="accommodation-checkin"> </div> <div class="form-control"> <label for="accommodation-checkout">Check-out (Data/Ora):</label> <input type="datetime-local" id="accommodation-checkout"> </div> </div>
                         <div class="form-row"> <div class="form-control"> <label for="accommodation-booking-ref">Rif. Prenotazione/Contatto:</label> <input type="text" id="accommodation-booking-ref"> </div> <div class="form-control"> <label for="accommodation-cost">Costo Totale (€, opzionale):</label> <input type="number" id="accommodation-cost" step="0.01" min="0" placeholder="0.00"> </div> </div>
                         <div class="form-control"> <label for="accommodation-notes">Note Aggiuntive:</label> <input type="text" id="accommodation-notes"> </div>
                         <div class="form-actions"> <button type="submit" id="accommodation-submit-btn" class="btn btn-secondary"><i class="fas fa-plus"></i> Aggiungi</button> <button type="button" id="accommodation-cancel-edit-btn" class="btn btn-cancel" style="display: none;"><i class="fas fa-times"></i> Annulla</button> </div>
                     </form>
                     <div class="item-list-container"> <h4>Alloggi Previsti:</h4> <ul id="accommodation-list" class="item-list"></ul> <p id="no-accommodation-items" class="center-text muted" style="display: none;">Nessun alloggio.</p> </div>
                </div>
                <!-- Tab: Itinerario -->
                <div id="itinerary-tab" class="tab-content card">
                    <h3><i class="fas fa-route"></i> Itinerario</h3>
                    <form id="add-itinerary-item-form" class="add-item-form">
                         <input type="hidden" id="edit-itinerary-item-id">
                         <div class="form-row"> <div class="form-control"> <label for="itinerary-day">Giorno:</label> <input type="date" id="itinerary-day" required> </div> <div class="form-control"> <label for="itinerary-time">Ora (opzionale):</label> <input type="time" id="itinerary-time"> </div> </div>
                        <div class="form-control"> <label for="itinerary-activity">Attività/Evento:</label> <input type="text" id="itinerary-activity" required> </div>
                        <div class="form-control"> <label for="itinerary-location">Luogo (opzionale):</label> <input type="text" id="itinerary-location"> </div>
                        <div class="form-row"> <div class="form-control"> <label for="itinerary-booking-ref">Rif. Prenotazione/Biglietto (opz.):</label> <input type="text" id="itinerary-booking-ref"> </div> <div class="form-control"> <label for="itinerary-cost">Costo (€, opzionale):</label> <input type="number" id="itinerary-cost" step="0.01" min="0" placeholder="0.00"> </div> </div>
                        <div class="form-control"> <label for="itinerary-notes">Note Aggiuntive:</label> <input type="text" id="itinerary-notes"> </div>
                        <div class="form-actions"> <button type="submit" id="itinerary-submit-btn" class="btn btn-secondary"><i class="fas fa-plus"></i> Aggiungi</button> <button type="button" id="itinerary-cancel-edit-btn" class="btn btn-cancel" style="display: none;"><i class="fas fa-times"></i> Annulla</button> </div>
                    </form>
                    <div class="item-list-container"> <h4>Programma:</h4> <ul id="itinerary-list" class="item-list"></ul> <p id="no-itinerary-items" class="center-text muted" style="display: none;">Nessun evento.</p> </div>
                </div>
                <!-- Tab: Budget -->
                <div id="budget-tab" class="tab-content card"> /* ... come prima ... */ </div>
                <!-- Tab: Packing List -->
                <div id="packing-tab" class="tab-content card"> /* ... come prima ... */ </div>
                <!-- == FINE CONTENUTO TABS == -->
            </main>
            <div id="welcome-message" class="welcome-message card"> /* ... come prima ... */ </div>
        </div>
        <footer> <p>© 2023 Travel Planner Pro</p> </footer>
    </div>

    <!-- Modals e Toast come prima -->
    <div id="new-trip-modal" class="modal"> /* ... */ </div>
    <div id="confirmation-modal" class="modal"> /* ... */ </div>
    <div id="toast-container"></div>

     <!-- Registrazione Service Worker -->
     <script> if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('/service-worker.js').then(reg=>console.log('SW registrato:', reg.scope)).catch(err=>console.error('SW registrazione fallita:', err)); }); } </script>
    <script src="script.js"></script> <!-- Script Principale -->
</body>
</html>
